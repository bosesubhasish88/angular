name: Testing Github Actions and Workflow
on: 
 #push:
    #branches:
    #  - 'master'
    #branches-ignore:
    #  - "master"
    pull_request:
      branches:
        - 'master'
        - 'dev'
jobs:
  lint_test_build:
    runs-on: ubuntu-latest
    outputs:
      branch: ${{ steps.extract_branch.outputs.branch }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Extract branch name
        shell: bash
        run: echo "::set-output name=branch::$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
      - name: Use Node.js 14.x
        uses: actions/setup-node@v1
        with:
          node-version: 14.x
          cache: 'npm'

      - name: Install npm packages
        run: npm ci

 #     - name: Run Lint
 #       run: npm run lint

      - name: Run unit test
        run: npm test -- --no-watch --no-progress --browsers=ChromeHeadlessCI

      - name: Build the application
        if: ${{ needs.build.outputs.branch == 'master' }}
        run: npm run build-prod
        if: ${{ needs.build.outputs.branch == 'dev' }}
        run: npm run build
      - name: Archive build
        if: success()
        uses: actions/upload-artifact@v1
        with:
          name: Aplication dist
          path: dist
      - name: Archive code coverage result
        if: success()
        uses: actions/upload-artifact@v1
        with:
          name: Test coverage
          path: coverage 